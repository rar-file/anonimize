# Dockerfile for development
# Includes all dev dependencies and mounts source code for live editing

FROM python:3.12-slim

WORKDIR /workspace

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    libpq-dev \
    git \
    bash \
    && rm -rf /var/lib/apt/lists/*

# Copy dependency files first for better caching
COPY pyproject.toml README.md LICENSE ./

# Install package in editable mode with all extras
RUN pip install --no-cache-dir -e ".[all,dev]"

# Create non-root user
RUN groupadd -r anonimize && \
    useradd -r -g anonimize -u 1000 -d /home/anonimize -s /bin/bash anonimize && \
    mkdir -p /data /home/anonimize && \
    chown -R anonimize:anonimize /workspace /data /home/anonimize

USER anonimize

# Default to bash for interactive development
CMD ["bash"]
